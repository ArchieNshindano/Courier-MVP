<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safiri - Track Parcel SFR-001258</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scroll on body */
        }
        body {
            display: flex;
            flex-direction: column;
            background-color: #f9fafb; /* safiri-gray-bg */
        }
        .main-content-area {
            flex-grow: 1; /* Allows this area to take up remaining vertical space */
            display: flex; /* Use flex for the two-panel layout */
            overflow: hidden; /* Prevent content from overflowing the main area */
        }
        .left-panel {
            display: flex;
            flex-direction: column;
            height: 100%; /* Fill the height of its parent (.main-content-area) */
        }
        .left-panel-scrollable-content {
            flex-grow: 1; /* Allows this to take available space within left-panel */
            overflow-y: auto;
        }
        .map-panel {
            flex-grow: 1; /* Allows map panel to take remaining width */
            display: flex; /* To make the map div fill it */
            position: relative; /* For potential absolute positioning of map controls */
        }
        #parcelGoogleMapStandalone {
            width: 100%;
            height: 100%;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; } /* Slimmer scrollbar */
        ::-webkit-scrollbar-track { background: #edf2f7; } /* Tailwind gray-200 */
        ::-webkit-scrollbar-thumb { background: #a0aec0; border-radius: 3px; } /* Tailwind gray-500 */
        ::-webkit-scrollbar-thumb:hover { background: #718096; } /* Tailwind gray-600 */

        .tab-button.active { border-bottom-color: #007bff; color: #007bff; font-weight: 600; }
        .tab-content-tracking { display: none; }
        .tab-content-tracking.active { display: block; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'safiri-blue': '#007bff', 'safiri-green': '#28a745',
                        'safiri-dark': '#1a202c', 'safiri-light-blue': '#ebf8ff',
                        'safiri-medium-dark': '#2d3748', 'safiri-gray-bg': '#f9fafb',
                        'safiri-border': '#e2e8f0',
                    }
                }
            }
        }
    </script>
</head>
<body class="text-safiri-dark antialiased">

    <header class="bg-white shadow-md sticky top-0 z-50 print:hidden flex-shrink-0">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <div class="flex items-center">
                 <a href="#" class="text-xl font-bold text-safiri-blue mr-6">safiri<span class="text-safiri-green">.</span> Client</a>
                 <h1 class="text-lg md:text-xl font-semibold text-safiri-dark">Track Parcel: <span id="display-parcel-id">SFR-001258</span></h1>
            </div>
            <div class="flex items-center space-x-3">
                <button class="p-2 rounded-full hover:bg-gray-100">
                    <svg class="w-5 h-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /></svg>
                </button>
                <img src="https://via.placeholder.com/32" alt="User Avatar" class="w-8 h-8 rounded-full cursor-pointer">
            </div>
        </div>
    </header>

    <!-- This main area will now use flex to manage height properly -->
    <main class="main-content-area p-4 md:p-6 lg:p-8">
        <div class="flex flex-col lg:flex-row gap-6 w-full h-full">
            <!-- Left Panel: Details & Timeline -->
            <div class="lg:w-2/5 xl:w-1/3 bg-white rounded-xl shadow-xl border border-safiri-border left-panel">
                <div class="p-4 border-b border-safiri-border flex-shrink-0">
                    <!-- Parcel Info Header -->
                     <div class="flex justify-between items-start">
                        <div>
                            <h2 id="tracking-parcel-id-display" class="text-lg font-semibold text-safiri-dark">Parcel ID: SFR-001258</h2>
                            <p id="tracking-parcel-status-display" class="text-sm font-medium text-safiri-green">Status: In Transit</p>
                        </div>
                        <span class="text-xs bg-safiri-blue text-white px-2 py-1 rounded-full">Express</span>
                    </div>
                    <div class="mt-3 text-xs text-gray-500 space-y-1">
                        <p><strong>Origin:</strong> <span id="tracking-origin-display" class="font-medium text-gray-700">Lusaka Main Hub, Zambia</span></p>
                        <p><strong>Destination:</strong> <span id="tracking-destination-display" class="font-medium text-gray-700">Ndola City Center, Zambia</span></p>
                        <p><strong>Est. Delivery:</strong> <span id="tracking-est-delivery-display" class="font-medium text-gray-700">Nov 06, 2023</span></p>
                    </div>
                     <div class="mt-3 p-2 bg-yellow-50 border border-yellow-300 rounded-md text-yellow-700 text-xs flex items-center">
                        <svg class="w-4 h-4 mr-2 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                        Minor delay reported at Kabwe. Est. delivery may shift by 1-2 hours.
                    </div>
                </div>

                <!-- Tabs -->
                <div class="border-b border-safiri-border flex-shrink-0">
                    <nav class="flex -mb-px px-4" id="tracking-tabs-standalone">
                        <button data-tab="live-track" class="tab-button active text-sm py-3 px-4 border-b-2 border-transparent hover:text-safiri-blue hover:border-safiri-blue focus:outline-none">Live Track</button>
                        <button data-tab="details" class="tab-button text-sm py-3 px-4 border-b-2 border-transparent text-gray-500 hover:text-safiri-blue hover:border-safiri-blue focus:outline-none">Details</button>
                        <button data-tab="history" class="tab-button text-sm py-3 px-4 border-b-2 border-transparent text-gray-500 hover:text-safiri-blue hover:border-safiri-blue focus:outline-none">History</button>
                    </nav>
                </div>

                <div class="left-panel-scrollable-content p-4 space-y-4">
                    <!-- Live Track Tab Content -->
                    <div id="live-track-tab-content" class="tab-content-tracking active space-y-4">
                        <!-- Journey Progress Chart and Timeline -->
                         <div>
                            <div class="flex justify-between items-center mb-1">
                                <h4 class="text-sm font-semibold text-gray-700">Journey Progress</h4>
                                <span class="text-xs text-gray-400">Updated: 09:48 AM</span>
                            </div>
                            <div class="relative chart-container h-24">
                                <canvas id="parcelJourneyChartStandalone"></canvas>
                            </div>
                        </div>
                        <div>
                             <div class="flex justify-between items-center mb-2">
                                <h4 class="text-sm font-semibold text-gray-700">Parcel Timeline</h4>
                                <button class="text-xs text-safiri-blue hover:underline flex items-center">
                                    <svg class="w-3 h-3 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.994 0c0 2.721-2.218 4.917-4.917 4.917S7.917 16.045 7.917 13.324m0 0c0-2.722 2.218-4.917 4.917-4.917s4.917 2.195 4.917 4.917m0 0H2.985" /></svg>
                                    Refresh
                                </button>
                            </div>
                            <ul class="space-y-4">
                                <!-- Timeline items -->
                                <li class="flex items-start relative pl-5 before:absolute before:left-2 before:top-3 before:bottom-0 before:w-0.5 before:bg-gray-200">
                                    <span class="absolute left-0 top-1.5 flex-shrink-0 w-5 h-5 bg-safiri-blue text-white rounded-full flex items-center justify-center text-xs z-10">✓</span>
                                    <div class="ml-3">
                                        <p class="text-xs text-gray-400">Nov 05, 2023 - 09:15 AM</p>
                                        <p class="text-sm font-medium text-gray-800">Departed from Lusaka Hub</p>
                                        <p class="text-xs text-gray-500">Next stop: Kabwe Checkpoint</p>
                                    </div>
                                </li>
                                <li class="flex items-start relative pl-5 before:absolute before:left-2 before:top-3 before:bottom-0 before:w-0.5 before:bg-gray-200">
                                    <span class="absolute left-0 top-1.5 flex-shrink-0 w-5 h-5 bg-safiri-blue text-white rounded-full flex items-center justify-center text-xs z-10">✓</span>
                                    <div class="ml-3">
                                        <p class="text-xs text-gray-400">Nov 04, 2023 - 02:30 PM</p>
                                        <p class="text-sm font-medium text-gray-800">Picked up by Courier</p>
                                        <p class="text-xs text-gray-500">Origin: Lusaka Main Warehouse</p>
                                    </div>
                                </li>
                                 <li class="flex items-start relative pl-5">
                                    <span class="absolute left-0 top-1.5 flex-shrink-0 w-5 h-5 bg-safiri-blue text-white rounded-full flex items-center justify-center text-xs z-10">✓</span>
                                    <div class="ml-3">
                                        <p class="text-xs text-gray-400">Nov 04, 2023 - 01:00 PM</p>
                                        <p class="text-sm font-medium text-gray-800">Order Confirmed & Processed</p>
                                        <p class="text-xs text-gray-500">Awaiting pickup</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- Details Tab Content -->
                    <div id="details-tab-content" class="tab-content-tracking space-y-3 text-sm">
                         <div><strong class="text-gray-600 w-24 inline-block">Sender:</strong> John Phiri</div>
                        <div><strong class="text-gray-600 w-24 inline-block">Recipient:</strong> Mary Banda</div>
                        <div><strong class="text-gray-600 w-24 inline-block">Contact:</strong> +260 977 123456</div>
                        <div><strong class="text-gray-600 w-24 inline-block">Dimensions:</strong> 30cm x 20cm x 15cm</div>
                        <div><strong class="text-gray-600 w-24 inline-block">Weight:</strong> 2.5 kg</div>
                        <div><strong class="text-gray-600 w-24 inline-block">Contents:</strong> Electronics (Fragile)</div>
                        <div><strong class="text-gray-600 w-24 inline-block">Service:</strong> Standard Express</div>
                        <div><strong class="text-gray-600 w-24 inline-block">Notes:</strong> Please handle with care. Call upon arrival.</div>
                    </div>
                    <!-- History Tab Content -->
                     <div id="history-tab-content" class="tab-content-tracking">
                        <p class="text-sm text-gray-600">Full detailed event history will be listed here, including timestamps and locations for each scan and status change.</p>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Map -->
            <div class="lg:w-3/5 xl:w-2/3 rounded-xl shadow-xl border border-safiri-border overflow-hidden map-panel">
                <div id="parcelGoogleMapStandalone">
                     <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-500 p-4 text-center">
                        Initializing Map... Please ensure API key is valid and API is enabled.
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ... (JavaScript for charts, map, and tabs from previous response remains largely the same) ...
        // Parcel Journey Chart (from previous response)
        let parcelJourneyChartInstanceStandalone;
        function initParcelJourneyChartStandalone() {
            if (parcelJourneyChartInstanceStandalone) parcelJourneyChartInstanceStandalone.destroy();
            const ctx = document.getElementById('parcelJourneyChartStandalone')?.getContext('2d');
            if (!ctx) return;
            parcelJourneyChartInstanceStandalone = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: ['Picked Up', 'In Transit', 'At Hub', 'Out for Delivery', 'Delivered'],
                    datasets: [{
                        data: [1, 1, 0.7, 0, 0], 
                        backgroundColor: ['#28a745', '#28a745', '#ffc107', '#e2e8f0', '#e2e8f0'],
                        borderWidth: 0, barPercentage: 0.6, categoryPercentage: 0.8
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { xAxes: [{ display: false, ticks: { beginAtZero: true, max: 1 } }], yAxes: [{ ticks: { fontColor: '#4a5568', fontSize: 10, mirror: true, labelOffset: -10, padding: 0 }, gridLines: { display: false } }] },
                    legend: { display: false }, tooltips: { enabled: false }
                }
            });
        }

        // Google Map
        let googleMapStandaloneInstance;
        function initMap() { // This function will be called by Google Maps API callback
            const mapElement = document.getElementById('parcelGoogleMapStandalone');
            if (!mapElement) {
                console.error("Map element #parcelGoogleMapStandalone not found.");
                return;
            }
            if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                mapElement.innerHTML = '<div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-500 text-sm p-4">Google Maps API did not load.</div>';
                console.error("Google Maps API not available.");
                return;
            }

            const lusaka = { lat: -15.3875, lng: 28.3228 };
            const ndola = { lat: -12.9587, lng: 28.6366 };
            const kabwe = { lat: -14.4461, lng: 28.4456 };
            const currentLocation = kabwe;

            const mapProp = {
              center: currentLocation, zoom: 7, mapTypeId: google.maps.MapTypeId.ROADMAP,
              disableDefaultUI: false, zoomControl: true, mapTypeControl: false,
              streetViewControl: false, fullscreenControl: true
            };
            googleMapStandaloneInstance = new google.maps.Map(mapElement, mapProp);

            new google.maps.Marker({ position: lusaka, map: googleMapStandaloneInstance, title: 'Origin: Lusaka', icon: { url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'} });
            new google.maps.Marker({ position: ndola, map: googleMapStandaloneInstance, title: 'Destination: Ndola', icon: { url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'} });
            new google.maps.Marker({
              position: currentLocation, map: googleMapStandaloneInstance, title: 'Current Location: Kabwe (Est.)',
              icon: { path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW, scale: 6, strokeColor: '#007bff', strokeWeight: 2, fillColor: '#007bff', fillOpacity: 1 }
            });
            const flightPath = new google.maps.Polyline({
              path: [lusaka, kabwe, ndola], geodesic: true, strokeColor: '#007bff', strokeOpacity: 0.7, strokeWeight: 5
            });
            flightPath.setMap(googleMapStandaloneInstance);
        }

        // Tab switching logic
        function setupStandaloneTrackingTabs() {
            const tabButtons = document.querySelectorAll('#tracking-tabs-standalone .tab-button');
            const tabContents = document.querySelectorAll('.tab-content-tracking');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === targetTab + '-tab-content') {
                            content.classList.add('active');
                        }
                    });
                });
            });
            if (tabButtons.length > 0) tabButtons[0].click();
        }

        document.addEventListener('DOMContentLoaded', () => {
            initParcelJourneyChartStandalone();
            setupStandaloneTrackingTabs();
            // Map init is handled by Google Maps API callback.
            
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    if (googleMapStandaloneInstance) {
                        const center = googleMapStandaloneInstance.getCenter();
                        google.maps.event.trigger(googleMapStandaloneInstance, 'resize');
                        if(center) googleMapStandaloneInstance.setCenter(center);
                    }
                    if(parcelJourneyChartInstanceStandalone) parcelJourneyChartInstanceStandalone.resize();
                }, 250);
            });
        });
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBDW4sQoz-LqSayNJ1an7FDj5AAqPQXW1I&callback=initMap"></script>

</body>
</html>